<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì—ì¦ˆìœ¤ Pick ë¯¼ê°í”¼ë¶€ ì¶”ì²œí…œ</title>

  <!-- ì•ˆì „í•œ CSV íŒŒì‹± -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;margin:0;padding:0;background:#f9fafb}
    .header img{max-width:100%;height:auto;max-height:60vh;margin:0 auto;display:block}

    .description{
      max-width:600px;margin:16px auto;padding:20px;
      background:#fff;border:1px solid #e5e7eb;border-radius:12px;
      box-shadow:0 1px 3px rgba(0,0,0,.1);text-align:center;color:#4b5563
    }
    .description p{margin:0 0 4px;line-height:1.6}
    .description strong{font-weight:700}

    .disclosure{
      max-width:600px;margin:0 auto 20px;padding:14px 16px;
      background:#fff;border:1px solid #e5e7eb;border-radius:12px;
      color:#4b5563;font-size:.95rem;line-height:1.55;text-align:center
    }

    .category{text-align:left;max-width:800px;margin:20px auto 8px;padding:10px 20px;border-radius:16px}
    .category.green{background:#e7f3e6}
    .category.blue{background:#e7f0fa}
    .category.yellow{background:#fff6cc}
    .category h2{font-size:1.5rem;color:#111827;margin:0;font-weight:800}

    .list{display:flex;flex-direction:column;gap:12px;max-width:800px;margin:12px auto 28px;padding:0 20px}
    .card{background:#fff;border-radius:16px;padding:16px 24px;max-width:600px;width:100%;margin:0 auto;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .content{border:none;border-radius:8px;padding:16px}
    .header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .score{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:1.25rem}
    .details{display:flex;gap:32px}
    .info{flex:1}
    .feature{display:flex;align-items:flex-start;gap:8px;margin-bottom:12px}
    .feature .emoji{min-width:20px} /* ì´ëª¨ì§€ í­ ê³ ì •í•´ì„œ ë¶ˆí•„ìš”í•œ ì¤„ë°”ê¿ˆ ê°ì†Œ */

    /* âœ… PC: ì´ë¯¸ì§€ 160x160 ì •ì‚¬ê°í˜• ìœ ì§€ */
    .image{width:160px;aspect-ratio:1/1;border-radius:12px;object-fit:cover}

    .button{display:inline-flex;align-items:center;gap:8px;margin-top:16px;padding:12px 22px;background:#60a5fa;color:#fff;font-size:.95rem;font-weight:800;border-radius:10px;text-decoration:none;transition:.25s}
    .button:hover{background:#3b82f6}

    .note{margin:16px auto 40px;color:#6b7280;font-size:.875rem;text-align:center;max-width:800px}

    /* ğŸ“± ëª¨ë°”ì¼ ì „ìš©(<=768px) */
    @media (max-width:768px){
      .header img{width:100vw;height:auto}
      .header{margin-bottom:12px;padding-bottom:8px}

      .description{padding:14px;margin:18px 12px 16px}
      .disclosure{margin:12px 12px 10px;padding:12px}
      .category{margin:14px auto 8px;padding:10px 16px}

      .list{padding:0 8px}
      .card{padding:14px 12px}

      /* í…ìŠ¤íŠ¸ê°€ ëœ ì¤„ë°”ê¿ˆ ë˜ë„ë¡ ì‚´ì§ ì¶•ì†Œ + ë‹¨ì–´ìª¼ê°œê¸° ìµœì†Œí™” */
      .feature span{font-size:.92rem;line-height:1.5;word-break:keep-all;letter-spacing:-0.1px}

      /* âœ… ëª¨ë°”ì¼: ì´ë¯¸ì§€ ì˜¤ë¥¸ìª½-ì•„ë˜ ê·€í‰ì´ë¡œ ë‚´ë¦¬ê³ , í…ìŠ¤íŠ¸ ì˜ì—­ì€ ì˜¤ë¥¸ìª½ ì—¬ë°± í™•ë³´ */
      .details{position:relative;gap:16px}
      .info{padding-right:112px}         /* ì´ë¯¸ì§€ ìë¦¬ë§Œí¼ë§Œ ì—¬ë°± í™•ë³´ (í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ê°ì†Œ) */
      .image{
        position:absolute;right:10px;bottom:10px;
        width:100px;aspect-ratio:1/1;border-radius:10px
      }
    }
  </style>
</head>
<body>
  <!-- ì»¤ë²„ ì´ë¯¸ì§€(ë ˆí¬ ë£¨íŠ¸ì— header-image.png) -->
  <div class="header"><img src="header-image.png" alt="Header Image"></div>

  <!-- ë‚´ëŸ¬í‹°ë¸Œ ë°•ìŠ¤ -->
  <div class="description">
    <p><strong>ğŸ’¡ ë˜ í”¼ë¶€ ë’¤ì§‘ì–´ì§€ê³ , ë˜ ëˆ ë²„ë¦¬ì§€ ì•Šë„ë¡.</strong></p>
    <p>âœ“ ìˆ˜ë°± ê°œ ì œí’ˆ ì „ì„±ë¶„ í•˜ë‚˜í•˜ë‚˜ ë¹„êµ</p>
    <p>âœ“ ê´€ë ¨ ë…¼ë¬¸ê¹Œì§€ íŒŒí—¤ì¹˜ë©° ë¦¬ì„œì¹˜</p>
    <p>âœ“ ë§ë¼ì„¸ì§€ì•„ ëª¨ë‚­ì—¼ ìœ ë°œ ì„±ë¶„ ì™„ë²½ ì²´í¬</p>
    <p><strong>ì§ì ‘ ê¹ê¹í•˜ê²Œ ê³ ë¥´ê³  ê³¨ëìŠµë‹ˆë‹¤.</strong></p><br/>
    <p>ì œ í”¼ë¶€ì— ì§ì ‘ ì¨ë³´ê³  ì‚´ì•„ë‚¨ì€ ì°í…œë“¤ë§Œ ëª¨ì•˜ìŠµë‹ˆë‹¤.</p>
    <p><strong>ë¯¼ê°í”¼ë¶€ë¥¼ ìœ„í•œ ë‹¨ í•˜ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ âœ¨</strong></p>
    <p><strong>ë¯¿ê³  ë³´ëŠ” ì—ì¦ˆìœ¤í”½, ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•´ë³´ì„¸ìš”!</strong></p>
  </div>

  <!-- ìˆ˜ìˆ˜ë£Œ ê³ ì§€ -->
  <div class="disclosure">
    ** êµ¬ë§¤í•˜ê¸° ë§í¬ë¥¼ í†µí•´ ì œí’ˆì„ êµ¬ì…í•˜ì‹œë©´<br/>
    ì˜¬ì˜/ì¿ íŒ¡íŒŒíŠ¸ë„ˆìŠ¤ ì¼í™˜ìœ¼ë¡œ ì†Œì •ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ë°›ê²Œ ë˜ì–´<br/>
    ì—ì¦ˆìœ¤ ì±„ë„ ìš´ì˜ ë° ì˜ìƒ ì œì‘ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤ :)
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ -->
  <div class="category green"><h2>1. í´ë Œì €</h2></div>
  <div id="list-í´ë Œì €" class="list"></div>
  <div class="category blue"><h2>2. í¬ë¦¼</h2></div>
  <div id="list-í¬ë¦¼" class="list"></div>
  <div class="category yellow"><h2>3. ì„ í¬ë¦¼</h2></div>
  <div id="list-ì„ í¬ë¦¼" class="list"></div>

  <p class="note">ë§ë¼ì„¸ì§€ì•„ ìœ ë°œ ì„±ë¶„ ê¸°ì¤€: 0ê°œ ìµœìƒ(ì´ˆë¡), 2â€“3ê°œ ì–‘í˜¸(ì—°ë…¸ë‘), 4â€“5ê°œ ì£¼ì˜(ì£¼í™©), 6â€“8ê°œ ê²½ê³„(ì‚´êµ¬), 9ê°œ ì´ìƒ ìœ„í—˜(ë¹¨ê°•)</p>

  <script>
    /* CSV */
    const RAW_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSiG4Jm5mSMOWJ6AA1fTWn2ZTBalNnWyhTdjbiPQtjiqkaeVXl-TKqnbLOwaaA801YmjKr119UBTiO/pub?gid=234443271&single=true&output=csv";
    const SHEET_CSV_URL = RAW_CSV + (RAW_CSV.includes('?') ? '&' : '?') + `_t=${Date.now()}`;

    /* íƒ€ì… ë§¤í•‘ */
    const TYPE_ALIASES = {"í´ë Œì €":"í´ë Œì €","cleanser":"í´ë Œì €","í¬ë¦¼":"í¬ë¦¼","cream":"í¬ë¦¼","ì„ í¬ë¦¼":"ì„ í¬ë¦¼","sunscreen":"ì„ í¬ë¦¼"};
    const CATEGORY_ORDER = ["í´ë Œì €","í¬ë¦¼","ì„ í¬ë¦¼"];
    const normalizeType = t => TYPE_ALIASES[(t||"").toLowerCase()] || (t||"");

    /* êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì´ë¯¸ì§€ í›„ë³´ URL */
    function extractDriveId(url){
      if(!url) return null;
      const clean = url.replace(/\uFEFF/g,'').trim();
      const m = clean.match(/[?&]id=([^&]+)/) || clean.match(/\/d\/([^/]+)/);
      return m ? m[1].trim() : null;
    }
    function buildDriveCandidates(url){
      const id = extractDriveId(url);
      if(!id) return [url];
      return [
        `https://drive.google.com/thumbnail?id=${id}&sz=w800`,
        `https://drive.google.com/uc?export=view&id=${id}`,
        `https://drive.google.com/uc?export=download&id=${id}`,
        url
      ];
    }

    /* ë°°ì§€ ìƒ‰ */
    function badgeColor(value){
      const n = Number(String(value).replace(/\D/g,'')) || 0;
      if(n<=1) return {bg:'#dcfce7', fg:'#16a34a'};
      if(n<=3) return {bg:'#fef9c3', fg:'#ca8a04'};
      if(n<=5) return {bg:'#fde68a', fg:'#b45309'};
      if(n<=8) return {bg:'#fee2e2', fg:'#b91c1c'};
      return {bg:'#fecaca', fg:'#991b1b'};
    }

    /* ì¹´ë“œ ìƒì„± */
    function createCard({name,img,malassezia,features,link}){
      const wrap=document.createElement('div'); wrap.className='card';
      const {bg,fg}=badgeColor(malassezia);
      const candidates = buildDriveCandidates(img);

      wrap.innerHTML=`
        <div class="content">
          <div class="header-row">
            <div>
              <h2 style="margin:0;font-size:1.25rem;font-weight:800;">${name||''}</h2>
              <p style="color:#4b5563;font-size:.95rem;margin-top:8px;">ë§ë¼ì„¸ì§€ì•„ ìœ ë°œ ì„±ë¶„: ${malassezia||'0ê°œ'}</p>
            </div>
            <div class="score" style="background:${bg};color:${fg};">${(malassezia||'0').toString().replace(/\D/g,'')||'0'}</div>
          </div>
          <div class="details">
            <div class="info"></div>
            <div><img class="image" referrerpolicy="no-referrer" loading="lazy" alt="${name||''}"></div>
          </div>
        </div>`;

      // ì´ë¯¸ì§€ ìˆœì°¨ ì‹œë„
      const imageEl = wrap.querySelector('img.image');
      let idx = 0;
      const tryNext = () => {
        if(idx >= candidates.length){
          imageEl.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(
            `<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160">
               <rect width="100%" height="100%" fill="#f3f4f6"/>
               <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="14">ì´ë¯¸ì§€ ì—†ìŒ</text>
             </svg>`
          );
          return;
        }
        imageEl.src = candidates[idx++];
      };
      imageEl.addEventListener('error', tryNext);
      tryNext();

      // íŠ¹ì§• ë¦¬ìŠ¤íŠ¸
      const info=wrap.querySelector('.info');
      (features||'').split(/\n|âœ”|âœ…|â–ª|â€¢|-\s/).map(s=>s.trim()).filter(Boolean).forEach(line=>{
        const row=document.createElement('div'); row.className='feature';
        row.innerHTML=`<span class="emoji">âœ…</span><span style="color:#4b5563;font-size:.95rem;">${line}</span>`;
        info.appendChild(row);
      });

      // êµ¬ë§¤ ë²„íŠ¼
      if(link){
        const a=document.createElement('a');
        a.href=link; a.target='_blank'; a.className='button'; a.textContent='êµ¬ë§¤í•˜ê¸°';
        info.appendChild(a);
      }
      return wrap;
    }

    /* CSV ë¡œë“œ â†’ ë Œë” */
    fetch(SHEET_CSV_URL)
      .then(r => r.text())
      .then(csv => {
        const { data } = Papa.parse(csv, { header:true, skipEmptyLines:true });
        const rows = (data||[]).map(r => ({
          type: normalizeType((r.type||'').trim()),
          img: (r.img||'').trim(),
          name: (r.name||'').trim(),
          malassezia: (r.malassezia||'').trim(),
          features: (r.features||'').trim(),
          link: (r.link||'').trim()
        }));
        CATEGORY_ORDER.forEach(type => {
          const target=document.getElementById(`list-${type}`);
          rows.filter(x => x.type === type).forEach(x => target.appendChild(createCard(x)));
        });
      });
  </script>
</body>
</html>
