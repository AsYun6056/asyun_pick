<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì—ì¦ˆìœ¤ Pick ë¯¼ê°í”¼ë¶€ ì¶”ì²œí…œ</title>

  <!-- ì•ˆì „í•œ CSV íŒŒì‹± -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ */
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;margin:0;padding:0;background:#f9fafb;color:#111827}
    .header img{max-width:100%;height:auto;max-height:60vh;margin:0 auto;display:block}

    .description{
      max-width:600px;margin:16px auto;padding:20px;
      background:#fff;border:1px solid #e5e7eb;border-radius:12px;
      box-shadow:0 1px 3px rgba(0,0,0,.1);text-align:center;color:#4b5563
    }
    .description p{margin:0 0 4px;line-height:1.6}
    .description strong{font-weight:700}

    .disclosure{
      max-width:600px;margin:0 auto 20px;padding:14px 16px;
      background:#fff;border:1px solid #e5e7eb;border-radius:12px;
      color:#4b5563;font-size:.95rem;line-height:1.55;text-align:center
    }

    .category{text-align:left;max-width:800px;margin:20px auto 8px;padding:10px 20px;border-radius:16px}
    .category.green{background:#e7f3e6}
    .category.blue{background:#e7f0fa}
    .category.yellow{background:#fff6cc}
    .category h2{font-size:1.5rem;color:#111827;margin:0;font-weight:800}

    .list{display:flex;flex-direction:column;gap:12px;max-width:800px;margin:12px auto 28px;padding:0 20px}

    /* ì¹´ë“œ ê³µí†µ */
    .card{background:#fff;border-radius:16px;padding:16px 24px;max-width:600px;width:100%;margin:0 auto;box-shadow:0 2px 10px rgba(0,0,0,.06);position:relative}
    .content{border:none;border-radius:8px;padding:16px}
    .header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .score{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:1.25rem}
    .details{display:flex;gap:32px}
    .info{flex:1}
    .feature{display:flex;align-items:flex-start;gap:8px;margin-bottom:12px}
    .feature span{word-break:keep-all;hyphens:auto}
    .image{object-fit:cover;border-radius:12px}
    .button{display:inline-flex;align-items:center;gap:8px;margin-top:16px;padding:12px 22px;background:#60a5fa;color:#fff;font-size:.95rem;font-weight:800;border-radius:10px;text-decoration:none;transition:.25s}
    .button:hover{background:#3b82f6}
    .note{margin:16px auto 40px;color:#6b7280;font-size:.875rem;text-align:center;max-width:800px}

    /* ì ìˆ˜ ì»¬ëŸ¬ */
    .score.green{background:#dcfce7;color:#16a34a}
    .score.yellow{background:#fef9c3;color:#ca8a04}
    .score.orange{background:#fde68a;color:#b45309}
    .score.red{background:#fecaca;color:#991b1b}

    /* âœ… PC ì „ìš© (ì´ë¯¸ì§€ 160x160 ì •ì‚¬ê° + ì ìˆ˜ ì›ì„ ì¹´ë“œ ìš°ì¸¡ ì¤‘ì•™ìœ¼ë¡œ) */
    @media (min-width: 769px){
      /* ë³¸ë¬¸ì€ ê·¸ë¦¬ë“œë¡œ: ì¢Œ í…ìŠ¤íŠ¸ / ìš° ì´ë¯¸ì§€ */
      .details{display:grid;grid-template-columns:1fr 160px;align-items:center;gap:32px}
      .image{width:160px;height:160px}

      /* ì ìˆ˜ ì›: ì¹´ë“œ ì˜¤ë¥¸ìª½ ì¤‘ì•™ì— ê³ ì • */
      .card{padding-right:96px}             /* ì ìˆ˜ ì›ê³¼ì˜ ê°„ì„­ ë°©ì§€ */
      .header-row{padding-right:0}          /* í—¤ë” ìì²´ëŠ” ì—¬ë°± ë¶ˆí•„ìš” */
      .score{
        position:absolute; right:24px; top:50%; transform:translateY(-50%);
      }
    }

    /* ğŸ“± ëª¨ë°”ì¼ ì „ìš© (ì´ë¯¸ì§€ ì˜¤ë¥¸ìª½ ì•„ë˜ ê·€í‰ì´ + ì¤„ë°”ê¿ˆ ìµœì†Œí™”) */
    @media (max-width:768px){
      .header img{width:100vw;height:auto}
      .header{margin-bottom:12px;padding-bottom:8px}

      .description{padding:14px;margin:18px 12px 16px}
      .disclosure{margin:12px 12px 10px;padding:12px}
      .category{margin:14px auto 8px;padding:10px 16px}

      .list{padding:0 8px}
      .card{padding:14px 10px}
      .content{padding:12px}

      /* í…ìŠ¤íŠ¸ ì˜ì—­ ìš°ì¸¡ì— ì´ë¯¸ì§€ ë“¤ì–´ê°ˆ ê³µê°„ í™•ë³´í•´ì„œ ì¤„ë°”ê¿ˆ ì¤„ì´ê¸° */
      .details{position:relative;display:block;padding-right:116px} /* 100px ì´ë¯¸ì§€ + ê°„ê²© */
      .image{position:absolute;right:8px;bottom:8px;width:100px;height:100px;border-radius:10px}

      /* ì ìˆ˜ ì›ì€ í—¤ë” ìš°ì¸¡ ê¸°ë³¸ ìœ„ì¹˜ ìœ ì§€(ëª¨ë°”ì¼ì€ ë³€ê²½ ì—†ìŒ) */
      .score{position:static;transform:none}

      .feature{margin-bottom:10px}
      .feature span{font-size:.95rem;line-height:1.55;word-break:keep-all;white-space:normal}
      .button{font-size:.95rem}
    }
  </style>
</head>
<body>
  <!-- ì»¤ë²„ ì´ë¯¸ì§€(ë ˆí¬ ë£¨íŠ¸ì— header-image.png) -->
  <div class="header"><img src="header-image.png" alt="Header Image"></div>

  <!-- ë‚´ëŸ¬í‹°ë¸Œ ë°•ìŠ¤ (ë¬¸êµ¬ ì›ë¬¸ ìœ ì§€) -->
  <div class="description">
    <p><strong>ğŸ’¡ ë˜ í”¼ë¶€ ë’¤ì§‘ì–´ì§€ê³ , ë˜ ëˆ ë²„ë¦¬ì§€ ì•Šë„ë¡.</strong></p>
    <p>âœ“ ìˆ˜ë°± ê°œ ì œí’ˆ ì „ì„±ë¶„ í•˜ë‚˜í•˜ë‚˜ ë¹„êµ</p>
    <p>âœ“ ê´€ë ¨ ë…¼ë¬¸ê¹Œì§€ íŒŒí—¤ì¹˜ë©° ë¦¬ì„œì¹˜</p>
    <p>âœ“ ë§ë¼ì„¸ì§€ì•„ ëª¨ë‚­ì—¼ ìœ ë°œ ì„±ë¶„ ì™„ë²½ ì²´í¬</p>
    <p><strong>ì§ì ‘ ê¹ê¹í•˜ê²Œ ê³ ë¥´ê³  ê³¨ëìŠµë‹ˆë‹¤.</strong></p><br/>
    <p>ì œ í”¼ë¶€ì— ì§ì ‘ ì¨ë³´ê³  ì‚´ì•„ë‚¨ì€ ì°í…œë“¤ë§Œ ëª¨ì•˜ìŠµë‹ˆë‹¤.</p>
    <p><strong>ë¯¼ê°í”¼ë¶€ë¥¼ ìœ„í•œ ë‹¨ í•˜ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ âœ¨</strong></p>
    <p><strong>ë¯¿ê³  ë³´ëŠ” ì—ì¦ˆìœ¤í”½, ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•´ë³´ì„¸ìš”!</strong></p>
  </div>

  <!-- ìˆ˜ìˆ˜ë£Œ ê³ ì§€ (ë¬¸êµ¬ ì›ë¬¸ ìœ ì§€) -->
  <div class="disclosure">
    ** êµ¬ë§¤í•˜ê¸° ë§í¬ë¥¼ í†µí•´ ì œí’ˆì„ êµ¬ì…í•˜ì‹œë©´<br/>
    ì˜¬ì˜/ì¿ íŒ¡íŒŒíŠ¸ë„ˆìŠ¤ ì¼í™˜ìœ¼ë¡œ ì†Œì •ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ë°›ê²Œ ë˜ì–´<br/>
    ì—ì¦ˆìœ¤ ì±„ë„ ìš´ì˜ ë° ì˜ìƒ ì œì‘ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤ :)
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ -->
  <div class="category green"><h2>1. í´ë Œì €</h2></div>
  <div id="list-í´ë Œì €" class="list"></div>
  <div class="category blue"><h2>2. í¬ë¦¼</h2></div>
  <div id="list-í¬ë¦¼" class="list"></div>
  <div class="category yellow"><h2>3. ì„ í¬ë¦¼</h2></div>
  <div id="list-ì„ í¬ë¦¼" class="list"></div>

  <p class="note">ë§ë¼ì„¸ì§€ì•„ ìœ ë°œ ì„±ë¶„ ê¸°ì¤€: 0ê°œ ìµœìƒ(ì´ˆë¡), 2â€“3ê°œ ì–‘í˜¸(ì—°ë…¸ë‘), 4â€“5ê°œ ì£¼ì˜(ì£¼í™©), 6â€“8ê°œ ê²½ê³„(ì‚´êµ¬), 9ê°œ ì´ìƒ ìœ„í—˜(ë¹¨ê°•)</p>

  <script>
    /* 1) CSV ì£¼ì†Œ(ì›¹ì— ê²Œì‹œ â†’ CSV) */
    const RAW_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSiG4Jm5mSMOWJ6AA1fTWn2ZTBalNnWyhTdjbiPQtjiqkaeVXl-TKqnbLOwaaA801YmjKr119UBTiO/pub?gid=234443271&single=true&output=csv";
    const SHEET_CSV_URL = RAW_CSV + (RAW_CSV.includes('?') ? '&' : '?') + `_t=${Date.now()}`;

    /* íƒ€ì… ë§¤í•‘ + ì„¹ì…˜ ìˆœì„œ */
    const TYPE_ALIASES = {"í´ë Œì €":"í´ë Œì €","cleanser":"í´ë Œì €","í¬ë¦¼":"í¬ë¦¼","cream":"í¬ë¦¼","ì„ í¬ë¦¼":"ì„ í¬ë¦¼","sunscreen":"ì„ í¬ë¦¼"};
    const CATEGORY_ORDER = ["í´ë Œì €","í¬ë¦¼","ì„ í¬ë¦¼"];
    const normalizeType = t => TYPE_ALIASES[(t||"").toLowerCase()] || (t||"");

    /* êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì´ë¯¸ì§€: íŒŒì¼ ID ì¶”ì¶œ + í›„ë³´ URLë“¤ ìƒì„± */
    function extractDriveId(url){
      if(!url) return null;
      const clean = url.replace(/\uFEFF/g,'').trim();
      const m = clean.match(/[?&]id=([^&]+)/) || clean.match(/\/d\/([^/]+)/) || clean.match(/id=([^&]+)/);
      return m ? m[1].trim() : null;
    }
    function buildDriveCandidates(url){
      const id = extractDriveId(url);
      if(!id) return [url]; // ì™¸ë¶€ URLì¼ ìˆ˜ ìˆìŒ
      return [
        `https://drive.google.com/thumbnail?id=${id}&sz=w800`,
        `https://drive.google.com/uc?export=view&id=${id}`,
        `https://drive.google.com/uc?export=download&id=${id}`,
        url
      ];
    }

    /* ë°°ì§€ ìƒ‰ */
    function badgeColor(value){
      const n = Number(String(value).replace(/\D/g,'')) || 0;
      if(n<=1) return 'green';
      if(n<=3) return 'yellow';
      if(n<=5) return 'orange';
      return 'red';
    }

    /* ì¹´ë“œ ìƒì„± */
    function createCard({name,img,malassezia,features,link}){
      const wrap=document.createElement('div'); wrap.className='card';
      const scoreClass = badgeColor(malassezia);
      const candidates = buildDriveCandidates(img);

      wrap.innerHTML=`
        <div class="content">
          <div class="header-row">
            <div>
              <h2 style="margin:0;font-size:1.25rem;font-weight:800;">${name||''}</h2>
              <p style="color:#4b5563;font-size:.95rem;margin-top:8px;">ë§ë¼ì„¸ì§€ì•„ ìœ ë°œ ì„±ë¶„: ${malassezia||'0ê°œ'}</p>
            </div>
            <div class="score ${scoreClass}">${(malassezia||'0').toString().replace(/\D/g,'')||'0'}</div>
          </div>
          <div class="details">
            <div class="info"></div>
            <div class="img-wrap"><img class="image" referrerpolicy="no-referrer" loading="lazy" alt="${name||''}"></div>
          </div>
        </div>`;

      // ì´ë¯¸ì§€ ìˆœì°¨ ì‹œë„
      const imageEl = wrap.querySelector('img.image');
      let idx = 0;
      const tryNext = () => {
        if(idx >= candidates.length){
          imageEl.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(
            `<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160">
               <rect width="100%" height="100%" fill="#f3f4f6"/>
               <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="14">ì´ë¯¸ì§€ ì—†ìŒ</text>
             </svg>`
          );
          return;
        }
        imageEl.src = candidates[idx++];
      };
      imageEl.addEventListener('error', tryNext);
      tryNext();

      // íŠ¹ì§• ë¦¬ìŠ¤íŠ¸
      const info=wrap.querySelector('.info');
      (features||'').split(/\n|âœ”|âœ…|â–ª|â€¢|-\s/).map(s=>s.trim()).filter(Boolean).forEach(line=>{
        const row=document.createElement('div'); row.className='feature';
        row.innerHTML=`<span class="emoji">âœ…</span><span style="color:#4b5563;font-size:1rem;">${line}</span>`;
        info.appendChild(row);
      });

      // êµ¬ë§¤ ë²„íŠ¼
      if(link){
        const a=document.createElement('a');
        a.href=link; a.target='_blank'; a.className='button'; a.textContent='êµ¬ë§¤í•˜ê¸°';
        info.appendChild(a);
      }
      return wrap;
    }

    /* CSV ë¡œë“œ â†’ íŒŒì‹± â†’ ë Œë” */
    fetch(SHEET_CSV_URL)
      .then(r => r.text())
      .then(csv => {
        const { data } = Papa.parse(csv, { header:true, skipEmptyLines:true });
        const rows = (data||[]).map(r => ({
          type:       normalizeType((r.type||'').trim()),
          img:        (r.img||'').trim(),
          name:       (r.name||'').trim(),
          malassezia: (r.malassezia||'').trim(),
          features:   (r.features||'').trim(),
          link:       (r.link||'').trim()
        }));

        CATEGORY_ORDER.forEach(type => {
          const target=document.getElementById(`list-${type}`);
          rows.filter(x => x.type === type).forEach(x => target.appendChild(createCard(x)));
        });
      })
      .catch(err => {
        console.error('CSV ë¡œë“œ ì˜¤ë¥˜', err);
        alert('CSVë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. "íŒŒì¼ â†’ ì›¹ì— ê²Œì‹œ â†’ CSV" ë§í¬ì™€ ì´ë¯¸ì§€ ê³µìœ  ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
      });
  </script>
</body>
</html>
