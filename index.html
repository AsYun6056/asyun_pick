<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì—ì¦ˆìœ¤ Pick ë¯¼ê°í”¼ë¶€ ì¶”ì²œí…œ</title>

  <!-- CSV íŒŒì‹± ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì¤„ë°”ê¿ˆ/ì‰¼í‘œ ì•ˆì „) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif; margin:0; padding:0; background:#f9fafb; }

    /* í—¤ë” ì´ë¯¸ì§€ */
    .header img { max-width:100%; height:auto; max-height:60vh; margin:0 auto; display:block; }

    /* ë‚´ëŸ¬í‹°ë¸Œ ë°•ìŠ¤ */
    .description{
      max-width:600px; margin:16px auto; padding:20px;
      background:#fff; border:1px solid #e5e7eb; border-radius:12px;
      box-shadow:0 1px 3px rgba(0,0,0,.1); text-align:center; color:#4b5563;
    }
    .description p{ margin:0 0 4px; line-height:1.6; }
    .description strong{ font-weight:700; }

    /* ìˆ˜ìˆ˜ë£Œ ê³ ì§€ */
    .disclosure{
      max-width:600px; margin:0 auto 20px; padding:14px 16px;
      background:#fff; border:1px solid #e5e7eb; border-radius:12px;
      color:#4b5563; font-size:.95rem; line-height:1.55; text-align:center;
    }

    /* ì¹´í…Œê³ ë¦¬ */
    .category{ text-align:left; max-width:800px; margin:20px auto 8px; padding:10px 20px; border-radius:16px; }
    .category.green  { background:#e7f3e6; } /* í´ë Œì € */
    .category.blue   { background:#e7f0fa; } /* í¬ë¦¼ */
    .category.yellow { background:#fff6cc; } /* ì„ í¬ë¦¼ */
    .category h2{ font-size:1.5rem; color:#111827; margin:0; font-weight:800; }

    /* ì¹´ë“œ */
    .list{ display:flex; flex-direction:column; gap:12px; max-width:800px; margin:12px auto 28px; padding:0 20px; }
    .card{ background:#fff; border-radius:16px; padding:16px 24px; max-width:600px; width:100%; margin:0 auto; box-shadow:0 2px 10px rgba(0,0,0,.06); }
    .content{ border:none; border-radius:8px; padding:16px; }
    .header-row{ display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .score{ width:64px; height:64px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:800; font-size:1.25rem; }
    .details{ display:flex; gap:32px; }
    .info{ flex:1; }
    .feature{ display:flex; align-items:flex-start; gap:8px; margin-bottom:12px; }
    .image{ width:260px; height:200px; border-radius:16px; object-fit:cover; }
    .button{ display:inline-flex; align-items:center; gap:8px; margin-top:16px; padding:12px 22px; background:#60a5fa; color:#fff; font-size:.95rem; font-weight:800; border-radius:10px; text-decoration:none; transition:.25s; }
    .button:hover{ background:#3b82f6; }

    .note{ margin:16px auto 40px; color:#6b7280; font-size:.875rem; text-align:center; max-width:800px; }

    @media (max-width:768px){
      .header img{ width:100vw; height:auto; }
      .description{ padding:10px; margin:0 10px; }
      .list{ padding:0 8px; }
      .card{ padding:14px 10px; }
      .image{ width:120px; height:120px; }
    }
  </style>
</head>
<body>
  <!-- ì»¤ë²„ ì´ë¯¸ì§€: ë ˆí¬ì— header-image.pngê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤ -->
  <div class="header">
    <img src="header-image.png" alt="Header Image">
  </div>

  <!-- ë‚´ëŸ¬í‹°ë¸Œ ë°•ìŠ¤ -->
  <div class="description">
    <p><strong>ğŸ’¡ ë˜ í”¼ë¶€ ë’¤ì§‘ì–´ì§€ê³ , ë˜ ëˆ ë²„ë¦¬ì§€ ì•Šë„ë¡.</strong></p>
    <p>âœ“ ìˆ˜ë°± ê°œ ì œí’ˆ ì „ì„±ë¶„ í•˜ë‚˜í•˜ë‚˜ ë¹„êµ</p>
    <p>âœ“ ê´€ë ¨ ë…¼ë¬¸ê¹Œì§€ íŒŒí—¤ì¹˜ë©° ë¦¬ì„œì¹˜</p>
    <p>âœ“ ë§ë¼ì„¸ì§€ì•„ ëª¨ë‚­ì—¼ ìœ ë°œ ì„±ë¶„ ì™„ë²½ ì²´í¬</p>
    <p><strong>ì§ì ‘ ê¹ê¹í•˜ê²Œ ê³ ë¥´ê³  ê³¨ëìŠµë‹ˆë‹¤.</strong></p>
    <br/>
    <p>ì œ í”¼ë¶€ì— ì§ì ‘ ì¨ë³´ê³  ì‚´ì•„ë‚¨ì€ ì°í…œë“¤ë§Œ ëª¨ì•˜ìŠµë‹ˆë‹¤.</p>
    <p><strong>ë¯¼ê°í”¼ë¶€ë¥¼ ìœ„í•œ ë‹¨ í•˜ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ âœ¨</strong></p>
    <p><strong>ë¯¿ê³  ë³´ëŠ” ì—ì¦ˆìœ¤í”½, ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•´ë³´ì„¸ìš”!</strong></p>
  </div>

  <!-- ìˆ˜ìˆ˜ë£Œ ê³ ì§€ -->
  <div class="disclosure">
    ** êµ¬ë§¤í•˜ê¸° ë§í¬ë¥¼ í†µí•´ ì œí’ˆì„ êµ¬ì…í•˜ì‹œë©´<br/>
    ì˜¬ë¦¬ë¸Œì˜ ë° ì¿ íŒ¡íŒŒíŠ¸ë„ˆìŠ¤ì˜ ì¼í™˜ìœ¼ë¡œ ì†Œì •ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ë°›ê²Œ ë˜ì–´,<br/>
    ì—ì¦ˆìœ¤ ì±„ë„ ìš´ì˜ ë° ì˜ìƒ ì œì‘ì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤ :)
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ ì˜ì—­ -->
  <div class="category green"><h2>1. í´ë Œì €</h2></div>
  <div id="list-í´ë Œì €" class="list"></div>

  <div class="category blue"><h2>2. í¬ë¦¼</h2></div>
  <div id="list-í¬ë¦¼" class="list"></div>

  <div class="category yellow"><h2>3. ì„ í¬ë¦¼</h2></div>
  <div id="list-ì„ í¬ë¦¼" class="list"></div>

  <p class="note">
    ë§ë¼ì„¸ì§€ì•„ ìœ ë°œ ì„±ë¶„ ê¸°ì¤€: 0ê°œ ìµœìƒ(ì´ˆë¡), 2â€“3ê°œ ì–‘í˜¸(ì—°ë…¸ë‘), 4â€“5ê°œ ì£¼ì˜(ì£¼í™©), 6â€“8ê°œ ê²½ê³„(ì‚´êµ¬), 9ê°œ ì´ìƒ ìœ„í—˜(ë¹¨ê°•)
  </p>

  <script>
    /* 1) ì›¹ì— ê²Œì‹œëœ CSV ì£¼ì†Œ (í˜„ì¬ ì£¼ì†Œ ìœ ì§€, ìºì‹œ ë°©ì§€ íŒŒë¼ë¯¸í„° ì¶”ê°€) */
    const RAW_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQSiG4Jm5mSMOWJ6AA1fTWn2ZTBalNnWyhTdjbiPQtjiqkaeVXl-TKqnbLOwaaA801YmjKr119UBTiO/pub?gid=234443271&single=true&output=csv";
    const SHEET_CSV_URL = RAW_CSV + (RAW_CSV.includes('?') ? '&' : '?') + `_t=${Date.now()}`;

    /* 2) íƒ€ì… ë³„ì¹­ + ì„¹ì…˜ ìˆœì„œ */
    const TYPE_ALIASES = { "í´ë Œì €":"í´ë Œì €","cleanser":"í´ë Œì €","í¬ë¦¼":"í¬ë¦¼","cream":"í¬ë¦¼","ì„ í¬ë¦¼":"ì„ í¬ë¦¼","sunscreen":"ì„ í¬ë¦¼" };
    const CATEGORY_ORDER = ["í´ë Œì €","í¬ë¦¼","ì„ í¬ë¦¼"];
    const normalizeType = t => TYPE_ALIASES[(t||"").toLowerCase()] || (t||"");

    /* 3) ë“œë¼ì´ë¸Œ ë§í¬ ë³´ì • (ì˜ˆë°©ìš©) */
    function toDirectDriveUrl(url){
      if(!url) return "";
      if(/^https:\/\/drive\.google\.com\/uc\?export=view&id=/.test(url)) return url;
      const m1 = url.match(/\/file\/d\/([^/]+)/);     // .../file/d/ID/...
      if(m1) return `https://drive.google.com/uc?export=view&id=${m1[1]}`;
      const m2 = url.match(/[?&]id=([^&]+)/);        // ...?id=ID
      if(m2) return `https://drive.google.com/uc?export=view&id=${m2[1]}`;
      return url;
    }

    /* 4) ë§ë¼ì„¸ì§€ì•„ ë°°ì§€ ìƒ‰ */
    function badgeColor(value){
      const n = Number(String(value).replace(/\D/g,'')) || 0;
      if(n <= 1) return { bg:'#dcfce7', fg:'#16a34a' };
      if(n <= 3) return { bg:'#fef9c3', fg:'#ca8a04' };
      if(n <= 5) return { bg:'#fde68a', fg:'#b45309' };
      if(n <= 8) return { bg:'#fee2e2', fg:'#b91c1c' };
      return { bg:'#fecaca', fg:'#991b1b' };
    }

    /* 5) ì¹´ë“œ ìƒì„± */
    function createCard({ name, img, malassezia, features, link }){
      const wrap = document.createElement('div');
      wrap.className = 'card';
      const { bg, fg } = badgeColor(malassezia);
      wrap.innerHTML = `
        <div class="content">
          <div class="header-row">
            <div>
              <h2 style="margin:0;font-size:1.25rem;font-weight:800;">${name||''}</h2>
              <p style="color:#4b5563;font-size:.95rem;margin-top:8px;">ë§ë¼ì„¸ì§€ì•„ ìœ ë°œ ì„±ë¶„: ${malassezia||'0ê°œ'}</p>
            </div>
            <div class="score" style="background:${bg}; color:${fg};">${(malassezia||'0').toString().replace(/\D/g,'')||'0'}</div>
          </div>
          <div class="details">
            <div class="info"></div>
            <div><img class="image" src="${toDirectDriveUrl(img)||''}" alt="${name||''}"/></div>
          </div>
        </div>
      `;
      const info = wrap.querySelector('.info');
      (features||'')
        .split(/\n|âœ”|âœ…|â–ª|â€¢|-\s/).map(s=>s.trim()).filter(Boolean)
        .forEach(line=>{
          const row = document.createElement('div');
          row.className = 'feature';
          row.innerHTML = `<span class="emoji">âœ…</span><span style="color:#4b5563;font-size:.95rem;">${line}</span>`;
          info.appendChild(row);
        });
      if(link){
        const btn = document.createElement('a');
        btn.href = link; btn.target="_blank"; btn.className="button"; btn.textContent="êµ¬ë§¤í•˜ê¸°";
        info.appendChild(btn);
      }
      return wrap;
    }

    /* 6) CSV ë¡œë“œ â†’ PapaParseë¡œ ì•ˆì • íŒŒì‹± â†’ ë Œë” */
    fetch(SHEET_CSV_URL)
      .then(r => {
        if(!r.ok) throw new Error(`CSV ìš”ì²­ ì‹¤íŒ¨: ${r.status}`);
        return r.text();
      })
      .then(csv => {
        const { data, errors } = Papa.parse(csv, { header:true, skipEmptyLines:true });
        if(errors?.length) console.warn('CSV parse warnings:', errors.slice(0,3));

        const rows = (data||[]).map(r => ({
          type:       normalizeType((r.type||'').trim()),
          img:        (r.img||'').trim(),
          name:       (r.name||'').trim(),
          malassezia: (r.malassezia||'').trim(),
          features:   (r.features||'').trim(),
          link:       (r.link||'').trim()
        }));

        CATEGORY_ORDER.forEach(type => {
          const target = document.getElementById(`list-${type}`);
          rows.filter(x => x.type === type).forEach(x => target.appendChild(createCard(x)));
        });
      })
      .catch(err => {
        console.error('CSV ë¡œë“œ ì˜¤ë¥˜', err);
        alert('CSVë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. "íŒŒì¼ â†’ ì›¹ì— ê²Œì‹œ â†’ CSV" ë§í¬ê°€ ë§ëŠ”ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.');
      });
  </script>
</body>
</html>
